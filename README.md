## What is this ?

In short this is Domain Specific Language (DSL) for [Rasa](rasa.com)  and can be used to generate all the required Rasa-files that you use to train your chatbot.

## Why I did it ?

Creating and modifying Rasa files is very akward especially for novices. The constant switching between files is often confusing and very error prone. F.e. you have to register "utterances" in two places, intents in two files.

Even simple mistake is costly because of the nature of the task i.e. the need for training which is time consuming.

There is no easy way to partition or combine sub projects.

In addition more language like feel seems better to me.

## Requirements :

  - you need CPP installed
  - hiyapyco module for the yaml thingy
  - bot_lang.py

I put the whole thing in a single file, so that you can just drop it in your Rasa project and be done.
Let me repeat as long as you have the dependencities available just drop in bot_lang.py and you are done.

## What do you get i.e. Features ...

  - Programming language feel
  - Ability to split/combine subprojects
  - Automatic update/sync of domain.yml : intent,actions ...
  - In stories you can directly use strings which will automatically become utterances
  - Merging .yaml files


## Subprojects

I used **CPP** (C preprocessor) #include capability to organize the projects.

In the general case you can use only ONE file for your full project if you wish.

But because of CPP you can split it any way you want :

  - one file for all
  - one file per type : yml, md
  - one file per project : test, banter, greetings, cousine, ...
  - one file per class : nlu, stories
  - combination of those
  - ... put them in different dirs with your preferred structure

***

## Syntax

Syntax is in general :

	 intent|say|utter <name> : <comma-list>;
	 
	 story <name> :
	        intent1 > action1
	    >>  intent2  > action2, action3; 
	    
	 actions|entities|... :  <comma-list>;

.... check the examples.

Normally you don't need to use quotes, but if you get error put quotes ;)

Strings in "story" become utterances automatically.

    story test :
         greet > "howdy !"
     >>  uok   > affirm, bye;


## Examples

Look at project directory ....


## domain.yml

You can have separate .yml file merged during compilation to the one generated by the process.


## cmd line

	    $ python bot_lang.py -h
	
	    usage: bot_lang.py [-h] --in-file IN_FNAME --out-prefix OUT_PREFIX [--out-path OUT_PATH] [--pp PP] [--pp-cleanup PP_CLEANUP] [--in-yaml IN_YAML] [--out-yaml OUT_YAML]
	
	    Bot language parser & generator for RASA chatbot ...
	     Ex.: bot_lang.py --in-file=./prj/test.inc --out-prefix=abc --out-path=./data --in-yaml=./prj/domain-exercise.yml  --out-yaml=./data/final.yaml
	
	    optional arguments:
	      -h, --help            show this help message and exit
	  --in-file IN_FNAME    input filename
	  --out-prefix OUT_PREFIX
	                        Prefix that is prepended on the output files
	  --out-path OUT_PATH   destination path
	  --pp PP               Preprocess ...
	  --pp-cleanup PP_CLEANUP
	                        should it clean tmp preprocess file
	  --in-yaml IN_YAML     /path/*.yml : mask of which YAML files to merge with the generated YAML
	  --out-yaml OUT_YAML   /path/fname.yml : final merged YAML file
	

**Example** :
	
	$ python bot_lang.py --in-file=./prj/test.inc --out-prefix=test --out-path=./tmp
	>> Process file:./prj/test.inc ...
	>> Preprocess : ./prj/test.inc => pp2426.out
	>> Generate RASA files ...
	  > ./tmp/test-nlu.md
	  > ./tmp/test-stories.md
	  > ./tmp/test-domain.yml
		
	
***


## usage from a Python program :

 **Example** testing Parser calls :

	b = BotLang()
	b.test('story greetings : howdy | hi{mood: good} | whatsup{a:b} > cool, "very cool";',start='story')
	
	b.dump()
	utter_3315:
	  - text: "very cool"
	['utter_3315']
	['utter_3315']
	## greetings
	* howdy OR hi{mood: good} OR whatsup{a: b}
	  - cool
	  - utter_3315
	
 **Example** of testing parsing a file :
 
	b.parse('./prj/test-domain.bl')
	Out[17]: Tree(start, [None, None])
	
	b.dump()
	['code : {type: unfeaturized}\netype : {type: unfeaturized}\neval_code : {type: unfeaturized}\nexample : {type: unfeaturized, auto_fill: false}\n', 'code : {type: unfeaturized}', 'etype : {type: unfeaturized}', 'eval_code : {type: unfeaturized}', 'example : {type: unfeaturized, auto_fill: false}']
	['test', 'abc', 'test', 'abc']
	
	

 **Example** compile calls :
	
	 c = BotLangCompiler()
	               src         ==>   dst
	 c.process("./prj/base.inc", out_prefix='base', out_path='./data')
	               src         ==>   dst                              generated_yaml+in_yaml    ==>  final.yml
	 c.process("./prj/test.inc", out_prefix='test', out_path='./tmp', in_yaml='./domain.yml', out_yaml='./tmp/final.yml')
	
	  Just merge yaml files :
	                        dst                         <===  generated  + yaml-files
	 c.merge_yaml(out_file='./tmp/merged.yml', generated_yaml='./prj/test-domain.yml', yaml_path='./', yaml_mask='d*.yml')
	